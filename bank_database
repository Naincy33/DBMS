-- this is a bank database

create database bank;
use bank;
create table Branch(
branchname varchar(30),
branchcity varchar(30),
assests real,
primary key(branchname));
create table BankAccount(
accno integer,
branchname varchar(30),
balance real,
primary key (accno),
foreign key (branchname) references Branch(branchname));
create table BankCustomer(
customername varchar(30),
customerstreet varchar(30),
customercity varchar(30),
primary key (customername));
create table Depositer(
customername varchar(30),
accno integer,
primary key (customername, accno),
foreign key (customername) references BankCustomer(customername),
foreign key (accno) references BankAccount (accno));
create table Loan(
loannumber int,
branchname varchar(30),
amount real,
primary key (loannumber),
foreign key (branchname) references Branch (branchname));

insert into Branch values
('SBI_chamrajpet', 'Bangalore', 50000),
('SBI_ResidencyRoad', 'Bangalore', 10000),
('SBI_ShivajiRod', 'Bombay', 20000),
('SBI_parliamentRoad', 'Delhi', 10000),
('SBI_Jantarmantar', 'Delhi', 20000);

insert into BankAccount values
(1, 'SBI_chamrajpet', 2000),
(2, 'SBI_ResidencyRoad', 5000),
(3, 'SBI_ShivajiRod', 6000),
(4, 'SBI_parliamentRoad', 9000),
(5, 'SBI_Jantarmantar', 8000);

insert into BankCustomer values
('Avinash', 'bull_temple', 'Bangalore'),
('Dinesh', 'Bannergatta_road', 'Bangalore'),
('Mohan', 'National_college', 'Bangalore'),
('Nikil', 'Akbar_road', 'Delhi'),
('Ravi', 'Prithviraj_road', 'Delhi');

insert into Depositer values
('Avinash', 1),
('Dinesh', 2),
('Nikil', 3),
('Ravi', 4),
('Avinash', 5);

insert into Loan values
(2, 'SBI_ResidencyRoad', 2000),
(1, 'SBI_chamrajpet', 1000),
(3, 'SBI_ShivajiRod', 3000),
(4, 'SBI_parliamentRoad', 4000),
(5, 'SBI_Jantarmantar', 5000);

INSERT INTO BankAccount (accno, branchname, balance) VALUES
(6, 'SBI_chamrajpet', 7000),
(7, 'SBI_Jantarmantar', 4500),
(8, 'SBI_ResidencyRoad', 3000);

SELECT accno
FROM BankAccount
WHERE branchname = 'SBI_ResidencyRoad';

SELECT customername, accno
FROM Depositer
WHERE accno IN (
    SELECT accno
    FROM BankAccount
    WHERE branchname = 'SBI_ResidencyRoad'
);

SELECT customername, COUNT(*) AS num_deposits
FROM Depositer
WHERE accno IN (
    SELECT accno
    FROM BankAccount
    WHERE branchname = 'SBI_ResidencyRoad'
)
GROUP BY customername
HAVING COUNT(*) >= 2;

